# 鸿蒙应用开发发布完整指南 (HarmonyOS / OpenHarmony, Stage 模型, ArkTS)

> 目标：给「vibe coding」一套从 0 到上架的完整路线图，尽量用清单 + 可直接执行的步骤。  
> 默认技术栈：ArkTS + ArkUI（声明式 UI）+ Stage 模型（UIAbility）+ ArkData(RDB)。

---

## 0. 你要做的是什么类型的鸿蒙应用？

- **应用模型**：Stage 模型（主流，推荐）
- **UI 框架**：ArkUI（声明式）
- **语言**：ArkTS（.ets）
- **打包产物**：
    - HAP：模块安装/运行基本单元
    - APP：上架/分发的应用包（由多个 HAP/HSP 组成的 App Pack，DevEco Studio 生成）

---

## 1. 环境与账号准备

### 1.1 工具链
- 安装 **DevEco Studio**（官方 IDE）
- 安装对应 **HarmonyOS SDK / OpenHarmony SDK**（按 API 版本选）

### 1.2 账号与控制台
- 注册 **Huawei Developer** 账号
- 开通 **AppGallery Connect（AGC）**
- 建议一开始就确定：
    - 应用发布地区/国家（是否面向中国大陆）
    - 证书主体（个人 or 企业）
    - 应用分类（工具、效率、教育等）

---

## 2. 项目创建与目录要点（Stage）

### 2.1 创建项目建议
- 模板：Empty Ability（或等价的 ArkUI Stage 模板）
- 组件：UIAbility + ArkUI page

### 2.2 关键配置文件（常见）
- `AppScope/app.json5`：应用级配置
- `entry/src/main/module.json5`：模块配置（abilities、权限等）
- `build-profile.json5`：构建配置（签名、buildMode、products 等）
- `oh-package.json5`：依赖描述（类似包管理）
- `resources/`：资源（strings、colors、media）

---

## 3. 开发阶段：你能做什么/不能做什么（第三方应用能力边界）

### 3.1 能做（重点对你的“专注 App”有用）
- 把自己的 UIAbility 拉到前台、切页、全屏沉浸式 UI（Focus UI）
- 启动后台能力：
    - ServiceAbility（偏持续型：下载、音乐等）
    - WorkSchedulerExtension（偏延迟/定时/条件触发任务）
- 应用内计时器（前台体验最好）
- 感知自身生命周期：
    - 用户离开应用（进入后台）
    - 用户回到应用（回到前台）
- 使用 BackgroundTasksKit 管理后台任务启动/停止与运行窗口
- 使用 ReminderAgent 创建由系统管理的提醒（定时/日历/闹钟式提醒）
- 监听基础设备信号：网络可用性、电量、亮灭屏（以系统公开能力为准）
- 链接到其他应用/系统设置页（做“引导式开启系统专注模式”的跳转）

### 3.2 不能做（产品设计必须绕开）
- 不能杀死、冻结、阻止其他 App（系统应用能力）
- 不能全局强制系统级“勿扰/专注模式”（系统能力）
- 不能读取/检查其他 App 的私有数据、内部状态、通知内容
- 不能持续精确监控“别的 App 是否在前台/正在使用”
- 不能 Hook 全局按键事件（Home/系统返回等不可被第三方全局监听）
- 应用后台计时 **无法保证完美精度**（尤其进程被系统回收时）

---

## 4. 面向你的专注 App：可落地的产品策略（Soft Focus）

### 4.1 核心策略
- 在应用内开启 **Focus Session（专注会话）**
- 会话具备：
    1) **倒计时**：到点发通知
    2) **软控制**：用户离开应用则暂停计时
    3) **挽留/提醒**：离开后可延迟 5 分钟再提醒
    4) **引导系统专注模式**：给步骤说明 + “去设置”跳转按钮
    5) **记录打断原因**：与会话/任务关联保存

### 4.2 后台提醒的推荐组合
- **主计时**：前台计时（UI 内实时显示）
- **离开提醒**：用户切后台时，写入暂停点并触发通知
- **到点提醒**：
    - 优先：ReminderAgent（系统托管提醒，稳定）
    - 补充：WorkScheduler（做“延迟提醒/条件触发”的兜底）

> 关键点：不要承诺“后台秒级精准倒计时”，而是承诺“提醒会到”。

---

## 5. 数据存储：ArkData RDB（SQLite 思路）落地

### 5.1 为什么选 RDB
- 本地、可离线
- 结构化查询强，适合：任务、会话、休息、打断原因、每日统计

### 5.2 SQLite 关键差异提醒（你已总结，必须写进工程约束）
- **外键约束默认不强制**：每次连接要显式开启
    - `PRAGMA foreign_keys = ON;`
- 外键列必须建索引（否则数据量大后会慢）

### 5.3 推荐数据表（最小可用版）
- `tasks`：待办事项（含匿名任务）
- `sessions`：一次“专注过程”（可包含多段 focus segment + 多次 break）
- `segments`：第 n 段专注（开始/结束/时长）
- `break_events`：休息事件（自动/手动、长度、是否跳过）
- `interruptions`：打断原因（文本/枚举），关联到 session + segment + task（可空）

---

## 6. 签名与证书（上架必经之路）

### 6.1 两类签名
- Debug：调试用
- Release：上架用（核心）

### 6.2 Release 签名文件典型组合（常见形态）
- 本地生成：`keystore(.p12)` + `CSR`
- AGC 获取：`release certificate(.cer)` + `release profile(.p7b)`
- DevEco Studio：在项目 Signing Config 中配置并用于 Release Build

---

## 7. 构建打包：生成可上传的 Release 包

### 7.1 DevEco Studio（GUI）
- Build 相关菜单生成 Release APP（或 Release HAP/APP 组合）
- 产物目录检查：
    - 包是否是 release 模式
    - 签名是否生效
    - 版本号、包名是否正确

### 7.2 命令行与 CI（可选但强烈推荐）
- 使用 hvigor/hvigorw 在 CI 里构建
- 典型用途：
    - 自动打包
    - 自动跑测试
    - 自动产出可上传包

---

## 8. 上架发布：AppGallery Connect 全流程清单

### 8.1 AGC 准备
- 创建应用条目（My Apps）
- 配置基础信息：
    - 名称、简介、关键词、分类
    - 图标、截图、宣传图
    - 版本说明（Release Notes）

### 8.2 合规材料（几乎都会要）
- **隐私政策**（Privacy Policy）
- **用户协议**（User Agreement，可选但建议）
- 权限用途说明（为什么要网络、通知、前台服务等）
- 内容分级/适龄信息
- 若面向中国大陆：可能涉及版权资质、软著、以及 App 备案等要求（按最新政策与实际上架提示为准）

### 8.3 上传、送审、发布
- 上传 Release 包
- 选择发布国家/地区
- 提交审核
- 通过后发布
- 进阶：分阶段发布（Phased Release）用于灰度

---

## 9. 版本迭代与运营（上线后的“第二战场”）
- 每次更新：
    - 版本号递增
    - 变更日志清晰
    - 新权限引入要更新隐私政策与权限说明
- 灰度发布：
    - 先小流量验证崩溃率与关键流程
- 关键指标建议记录：
    - 每日专注总时长、任务完成数、打断次数
    - 7 天趋势（激励用）

---

## 10. 你的专注 App：MVP 上架交付物清单（可直接照做）

### 10.1 应用功能（Must）
- 待办事项 CRUD
- 单任务专注计时（多段 segment）
- 直接计时并保存匿名完成事项
- 休息会话（间隔 + 时长）与通知
- 切后台自动暂停 + 提醒
- 打断原因记录
- 本地 RDB 持久化

### 10.2 上架材料（Must）
- 应用图标、至少 3 张截图
- 隐私政策、权限用途说明
- 应用简介 + 关键词
- 测试账号（若你的 App 有登录且审核需要）

---

## 参考链接（建议你在 Claude 里当作“真相来源”喂进去）
- AppGallery Connect：准备与发布
    - https://developer.huawei.com/consumer/en/doc/app/agc-help-release-app-prepare-0000002306311921
    - https://developer.huawei.com/consumer/en/doc/app/agc-help-releaseapkrpk-0000001106463276
    - https://developer.huawei.com/consumer/en/doc/app/agc-help-phased-release-0000001099836872
- Release Profile / Signing
    - https://developer.huawei.com/consumer/en/doc/app/agc-help-add-releaseprofile-0000001914714796
    - https://developer.huawei.com/consumer/en/doc/harmonyos-guides-V13/ide-signing-V13
- 构建产物（HAP/HAR/HSP/APP）
    - https://developer.huawei.com/consumer/en/doc/harmonyos-guides/ide-compile-build
    - https://docs.openharmony.cn/pages/v4.1/en/application-dev/quick-start/application-package-structure-stage.md
